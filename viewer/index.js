var mr=Object.create;var yt=Object.defineProperty;var yr=Object.getOwnPropertyDescriptor;var wr=Object.getOwnPropertyNames;var gr=Object.getPrototypeOf,Er=Object.prototype.hasOwnProperty;var Sr=(t,e)=>()=>(t&&(e=t(t=0)),e);var M=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports);var Ar=(t,e,r,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of wr(e))!Er.call(t,i)&&i!==r&&yt(t,i,{get:()=>e[i],enumerable:!(n=yr(e,i))||n.enumerable});return t};var wt=(t,e,r)=>(r=t!=null?mr(gr(t)):{},Ar(e||!t||!t.__esModule?yt(r,"default",{value:t,enumerable:!0}):r,t));var St=M(Ae=>{"use strict";s();Ae.byteLength=br;Ae.toByteArray=Cr;Ae.fromByteArray=Ir;var D=[],W=[],xr=typeof Uint8Array<"u"?Uint8Array:Array,Ge="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(V=0,gt=Ge.length;V<gt;++V)D[V]=Ge[V],W[Ge.charCodeAt(V)]=V;var V,gt;W["-".charCodeAt(0)]=62;W["_".charCodeAt(0)]=63;function Et(t){var e=t.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var r=t.indexOf("=");r===-1&&(r=e);var n=r===e?0:4-r%4;return[r,n]}function br(t){var e=Et(t),r=e[0],n=e[1];return(r+n)*3/4-n}function _r(t,e,r){return(e+r)*3/4-r}function Cr(t){var e,r=Et(t),n=r[0],i=r[1],o=new xr(_r(t,n,i)),a=0,p=i>0?n-4:n,u;for(u=0;u<p;u+=4)e=W[t.charCodeAt(u)]<<18|W[t.charCodeAt(u+1)]<<12|W[t.charCodeAt(u+2)]<<6|W[t.charCodeAt(u+3)],o[a++]=e>>16&255,o[a++]=e>>8&255,o[a++]=e&255;return i===2&&(e=W[t.charCodeAt(u)]<<2|W[t.charCodeAt(u+1)]>>4,o[a++]=e&255),i===1&&(e=W[t.charCodeAt(u)]<<10|W[t.charCodeAt(u+1)]<<4|W[t.charCodeAt(u+2)]>>2,o[a++]=e>>8&255,o[a++]=e&255),o}function Hr(t){return D[t>>18&63]+D[t>>12&63]+D[t>>6&63]+D[t&63]}function Kr(t,e,r){for(var n,i=[],o=e;o<r;o+=3)n=(t[o]<<16&16711680)+(t[o+1]<<8&65280)+(t[o+2]&255),i.push(Hr(n));return i.join("")}function Ir(t){for(var e,r=t.length,n=r%3,i=[],o=16383,a=0,p=r-n;a<p;a+=o)i.push(Kr(t,a,a+o>p?p:a+o));return n===1?(e=t[r-1],i.push(D[e>>2]+D[e<<4&63]+"==")):n===2&&(e=(t[r-2]<<8)+t[r-1],i.push(D[e>>10]+D[e>>4&63]+D[e<<2&63]+"=")),i.join("")}});var At=M(Ve=>{s();Ve.read=function(t,e,r,n,i){var o,a,p=i*8-n-1,u=(1<<p)-1,h=u>>1,l=-7,f=r?i-1:0,A=r?-1:1,E=t[e+f];for(f+=A,o=E&(1<<-l)-1,E>>=-l,l+=p;l>0;o=o*256+t[e+f],f+=A,l-=8);for(a=o&(1<<-l)-1,o>>=-l,l+=n;l>0;a=a*256+t[e+f],f+=A,l-=8);if(o===0)o=1-h;else{if(o===u)return a?NaN:(E?-1:1)*(1/0);a=a+Math.pow(2,n),o=o-h}return(E?-1:1)*a*Math.pow(2,o-n)};Ve.write=function(t,e,r,n,i,o){var a,p,u,h=o*8-i-1,l=(1<<h)-1,f=l>>1,A=i===23?Math.pow(2,-24)-Math.pow(2,-77):0,E=n?0:o-1,J=n?1:-1,Ee=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(p=isNaN(e)?1:0,a=l):(a=Math.floor(Math.log(e)/Math.LN2),e*(u=Math.pow(2,-a))<1&&(a--,u*=2),a+f>=1?e+=A/u:e+=A*Math.pow(2,1-f),e*u>=2&&(a++,u/=2),a+f>=l?(p=0,a=l):a+f>=1?(p=(e*u-1)*Math.pow(2,i),a=a+f):(p=e*Math.pow(2,f-1)*Math.pow(2,i),a=0));i>=8;t[r+E]=p&255,E+=J,p/=256,i-=8);for(a=a<<i|p,h+=i;h>0;t[r+E]=a&255,E+=J,a/=256,h-=8);t[r+E-J]|=Ee*128}});var Ot=M(re=>{"use strict";s();var ze=St(),ee=At(),xt=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;re.Buffer=c;re.SlowBuffer=Ur;re.INSPECT_MAX_BYTES=50;var xe=2147483647;re.kMaxLength=xe;c.TYPED_ARRAY_SUPPORT=Pr();!c.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function Pr(){try{let t=new Uint8Array(1),e={foo:function(){return 42}};return Object.setPrototypeOf(e,Uint8Array.prototype),Object.setPrototypeOf(t,e),t.foo()===42}catch{return!1}}Object.defineProperty(c.prototype,"parent",{enumerable:!0,get:function(){if(!!c.isBuffer(this))return this.buffer}});Object.defineProperty(c.prototype,"offset",{enumerable:!0,get:function(){if(!!c.isBuffer(this))return this.byteOffset}});function k(t){if(t>xe)throw new RangeError('The value "'+t+'" is invalid for option "size"');let e=new Uint8Array(t);return Object.setPrototypeOf(e,c.prototype),e}function c(t,e,r){if(typeof t=="number"){if(typeof e=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return Ze(t)}return Ht(t,e,r)}c.poolSize=8192;function Ht(t,e,r){if(typeof t=="string")return Br(t,e);if(ArrayBuffer.isView(t))return Rr(t);if(t==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof t);if(O(t,ArrayBuffer)||t&&O(t.buffer,ArrayBuffer)||typeof SharedArrayBuffer<"u"&&(O(t,SharedArrayBuffer)||t&&O(t.buffer,SharedArrayBuffer)))return Xe(t,e,r);if(typeof t=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');let n=t.valueOf&&t.valueOf();if(n!=null&&n!==t)return c.from(n,e,r);let i=Wr(t);if(i)return i;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof t[Symbol.toPrimitive]=="function")return c.from(t[Symbol.toPrimitive]("string"),e,r);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof t)}c.from=function(t,e,r){return Ht(t,e,r)};Object.setPrototypeOf(c.prototype,Uint8Array.prototype);Object.setPrototypeOf(c,Uint8Array);function Kt(t){if(typeof t!="number")throw new TypeError('"size" argument must be of type number');if(t<0)throw new RangeError('The value "'+t+'" is invalid for option "size"')}function vr(t,e,r){return Kt(t),t<=0?k(t):e!==void 0?typeof r=="string"?k(t).fill(e,r):k(t).fill(e):k(t)}c.alloc=function(t,e,r){return vr(t,e,r)};function Ze(t){return Kt(t),k(t<0?0:Qe(t)|0)}c.allocUnsafe=function(t){return Ze(t)};c.allocUnsafeSlow=function(t){return Ze(t)};function Br(t,e){if((typeof e!="string"||e==="")&&(e="utf8"),!c.isEncoding(e))throw new TypeError("Unknown encoding: "+e);let r=It(t,e)|0,n=k(r),i=n.write(t,e);return i!==r&&(n=n.slice(0,i)),n}function Ye(t){let e=t.length<0?0:Qe(t.length)|0,r=k(e);for(let n=0;n<e;n+=1)r[n]=t[n]&255;return r}function Rr(t){if(O(t,Uint8Array)){let e=new Uint8Array(t);return Xe(e.buffer,e.byteOffset,e.byteLength)}return Ye(t)}function Xe(t,e,r){if(e<0||t.byteLength<e)throw new RangeError('"offset" is outside of buffer bounds');if(t.byteLength<e+(r||0))throw new RangeError('"length" is outside of buffer bounds');let n;return e===void 0&&r===void 0?n=new Uint8Array(t):r===void 0?n=new Uint8Array(t,e):n=new Uint8Array(t,e,r),Object.setPrototypeOf(n,c.prototype),n}function Wr(t){if(c.isBuffer(t)){let e=Qe(t.length)|0,r=k(e);return r.length===0||t.copy(r,0,0,e),r}if(t.length!==void 0)return typeof t.length!="number"||et(t.length)?k(0):Ye(t);if(t.type==="Buffer"&&Array.isArray(t.data))return Ye(t.data)}function Qe(t){if(t>=xe)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+xe.toString(16)+" bytes");return t|0}function Ur(t){return+t!=t&&(t=0),c.alloc(+t)}c.isBuffer=function(e){return e!=null&&e._isBuffer===!0&&e!==c.prototype};c.compare=function(e,r){if(O(e,Uint8Array)&&(e=c.from(e,e.offset,e.byteLength)),O(r,Uint8Array)&&(r=c.from(r,r.offset,r.byteLength)),!c.isBuffer(e)||!c.isBuffer(r))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(e===r)return 0;let n=e.length,i=r.length;for(let o=0,a=Math.min(n,i);o<a;++o)if(e[o]!==r[o]){n=e[o],i=r[o];break}return n<i?-1:i<n?1:0};c.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}};c.concat=function(e,r){if(!Array.isArray(e))throw new TypeError('"list" argument must be an Array of Buffers');if(e.length===0)return c.alloc(0);let n;if(r===void 0)for(r=0,n=0;n<e.length;++n)r+=e[n].length;let i=c.allocUnsafe(r),o=0;for(n=0;n<e.length;++n){let a=e[n];if(O(a,Uint8Array))o+a.length>i.length?(c.isBuffer(a)||(a=c.from(a)),a.copy(i,o)):Uint8Array.prototype.set.call(i,a,o);else if(c.isBuffer(a))a.copy(i,o);else throw new TypeError('"list" argument must be an Array of Buffers');o+=a.length}return i};function It(t,e){if(c.isBuffer(t))return t.length;if(ArrayBuffer.isView(t)||O(t,ArrayBuffer))return t.byteLength;if(typeof t!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof t);let r=t.length,n=arguments.length>2&&arguments[2]===!0;if(!n&&r===0)return 0;let i=!1;for(;;)switch(e){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":return qe(t).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return r*2;case"hex":return r>>>1;case"base64":return Dt(t).length;default:if(i)return n?-1:qe(t).length;e=(""+e).toLowerCase(),i=!0}}c.byteLength=It;function Tr(t,e,r){let n=!1;if((e===void 0||e<0)&&(e=0),e>this.length||((r===void 0||r>this.length)&&(r=this.length),r<=0)||(r>>>=0,e>>>=0,r<=e))return"";for(t||(t="utf8");;)switch(t){case"hex":return Gr(this,e,r);case"utf8":case"utf-8":return vt(this,e,r);case"ascii":return Lr(this,e,r);case"latin1":case"binary":return $r(this,e,r);case"base64":return Mr(this,e,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Vr(this,e,r);default:if(n)throw new TypeError("Unknown encoding: "+t);t=(t+"").toLowerCase(),n=!0}}c.prototype._isBuffer=!0;function z(t,e,r){let n=t[e];t[e]=t[r],t[r]=n}c.prototype.swap16=function(){let e=this.length;if(e%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let r=0;r<e;r+=2)z(this,r,r+1);return this};c.prototype.swap32=function(){let e=this.length;if(e%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let r=0;r<e;r+=4)z(this,r,r+3),z(this,r+1,r+2);return this};c.prototype.swap64=function(){let e=this.length;if(e%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let r=0;r<e;r+=8)z(this,r,r+7),z(this,r+1,r+6),z(this,r+2,r+5),z(this,r+3,r+4);return this};c.prototype.toString=function(){let e=this.length;return e===0?"":arguments.length===0?vt(this,0,e):Tr.apply(this,arguments)};c.prototype.toLocaleString=c.prototype.toString;c.prototype.equals=function(e){if(!c.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e?!0:c.compare(this,e)===0};c.prototype.inspect=function(){let e="",r=re.INSPECT_MAX_BYTES;return e=this.toString("hex",0,r).replace(/(.{2})/g,"$1 ").trim(),this.length>r&&(e+=" ... "),"<Buffer "+e+">"};xt&&(c.prototype[xt]=c.prototype.inspect);c.prototype.compare=function(e,r,n,i,o){if(O(e,Uint8Array)&&(e=c.from(e,e.offset,e.byteLength)),!c.isBuffer(e))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof e);if(r===void 0&&(r=0),n===void 0&&(n=e?e.length:0),i===void 0&&(i=0),o===void 0&&(o=this.length),r<0||n>e.length||i<0||o>this.length)throw new RangeError("out of range index");if(i>=o&&r>=n)return 0;if(i>=o)return-1;if(r>=n)return 1;if(r>>>=0,n>>>=0,i>>>=0,o>>>=0,this===e)return 0;let a=o-i,p=n-r,u=Math.min(a,p),h=this.slice(i,o),l=e.slice(r,n);for(let f=0;f<u;++f)if(h[f]!==l[f]){a=h[f],p=l[f];break}return a<p?-1:p<a?1:0};function Pt(t,e,r,n,i){if(t.length===0)return-1;if(typeof r=="string"?(n=r,r=0):r>2147483647?r=2147483647:r<-2147483648&&(r=-2147483648),r=+r,et(r)&&(r=i?0:t.length-1),r<0&&(r=t.length+r),r>=t.length){if(i)return-1;r=t.length-1}else if(r<0)if(i)r=0;else return-1;if(typeof e=="string"&&(e=c.from(e,n)),c.isBuffer(e))return e.length===0?-1:bt(t,e,r,n,i);if(typeof e=="number")return e=e&255,typeof Uint8Array.prototype.indexOf=="function"?i?Uint8Array.prototype.indexOf.call(t,e,r):Uint8Array.prototype.lastIndexOf.call(t,e,r):bt(t,[e],r,n,i);throw new TypeError("val must be string, number or Buffer")}function bt(t,e,r,n,i){let o=1,a=t.length,p=e.length;if(n!==void 0&&(n=String(n).toLowerCase(),n==="ucs2"||n==="ucs-2"||n==="utf16le"||n==="utf-16le")){if(t.length<2||e.length<2)return-1;o=2,a/=2,p/=2,r/=2}function u(l,f){return o===1?l[f]:l.readUInt16BE(f*o)}let h;if(i){let l=-1;for(h=r;h<a;h++)if(u(t,h)===u(e,l===-1?0:h-l)){if(l===-1&&(l=h),h-l+1===p)return l*o}else l!==-1&&(h-=h-l),l=-1}else for(r+p>a&&(r=a-p),h=r;h>=0;h--){let l=!0;for(let f=0;f<p;f++)if(u(t,h+f)!==u(e,f)){l=!1;break}if(l)return h}return-1}c.prototype.includes=function(e,r,n){return this.indexOf(e,r,n)!==-1};c.prototype.indexOf=function(e,r,n){return Pt(this,e,r,n,!0)};c.prototype.lastIndexOf=function(e,r,n){return Pt(this,e,r,n,!1)};function Jr(t,e,r,n){r=Number(r)||0;let i=t.length-r;n?(n=Number(n),n>i&&(n=i)):n=i;let o=e.length;n>o/2&&(n=o/2);let a;for(a=0;a<n;++a){let p=parseInt(e.substr(a*2,2),16);if(et(p))return a;t[r+a]=p}return a}function Dr(t,e,r,n){return be(qe(e,t.length-r),t,r,n)}function Or(t,e,r,n){return be(qr(e),t,r,n)}function Fr(t,e,r,n){return be(Dt(e),t,r,n)}function Nr(t,e,r,n){return be(Zr(e,t.length-r),t,r,n)}c.prototype.write=function(e,r,n,i){if(r===void 0)i="utf8",n=this.length,r=0;else if(n===void 0&&typeof r=="string")i=r,n=this.length,r=0;else if(isFinite(r))r=r>>>0,isFinite(n)?(n=n>>>0,i===void 0&&(i="utf8")):(i=n,n=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");let o=this.length-r;if((n===void 0||n>o)&&(n=o),e.length>0&&(n<0||r<0)||r>this.length)throw new RangeError("Attempt to write outside buffer bounds");i||(i="utf8");let a=!1;for(;;)switch(i){case"hex":return Jr(this,e,r,n);case"utf8":case"utf-8":return Dr(this,e,r,n);case"ascii":case"latin1":case"binary":return Or(this,e,r,n);case"base64":return Fr(this,e,r,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Nr(this,e,r,n);default:if(a)throw new TypeError("Unknown encoding: "+i);i=(""+i).toLowerCase(),a=!0}};c.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function Mr(t,e,r){return e===0&&r===t.length?ze.fromByteArray(t):ze.fromByteArray(t.slice(e,r))}function vt(t,e,r){r=Math.min(t.length,r);let n=[],i=e;for(;i<r;){let o=t[i],a=null,p=o>239?4:o>223?3:o>191?2:1;if(i+p<=r){let u,h,l,f;switch(p){case 1:o<128&&(a=o);break;case 2:u=t[i+1],(u&192)===128&&(f=(o&31)<<6|u&63,f>127&&(a=f));break;case 3:u=t[i+1],h=t[i+2],(u&192)===128&&(h&192)===128&&(f=(o&15)<<12|(u&63)<<6|h&63,f>2047&&(f<55296||f>57343)&&(a=f));break;case 4:u=t[i+1],h=t[i+2],l=t[i+3],(u&192)===128&&(h&192)===128&&(l&192)===128&&(f=(o&15)<<18|(u&63)<<12|(h&63)<<6|l&63,f>65535&&f<1114112&&(a=f))}}a===null?(a=65533,p=1):a>65535&&(a-=65536,n.push(a>>>10&1023|55296),a=56320|a&1023),n.push(a),i+=p}return kr(n)}var _t=4096;function kr(t){let e=t.length;if(e<=_t)return String.fromCharCode.apply(String,t);let r="",n=0;for(;n<e;)r+=String.fromCharCode.apply(String,t.slice(n,n+=_t));return r}function Lr(t,e,r){let n="";r=Math.min(t.length,r);for(let i=e;i<r;++i)n+=String.fromCharCode(t[i]&127);return n}function $r(t,e,r){let n="";r=Math.min(t.length,r);for(let i=e;i<r;++i)n+=String.fromCharCode(t[i]);return n}function Gr(t,e,r){let n=t.length;(!e||e<0)&&(e=0),(!r||r<0||r>n)&&(r=n);let i="";for(let o=e;o<r;++o)i+=Qr[t[o]];return i}function Vr(t,e,r){let n=t.slice(e,r),i="";for(let o=0;o<n.length-1;o+=2)i+=String.fromCharCode(n[o]+n[o+1]*256);return i}c.prototype.slice=function(e,r){let n=this.length;e=~~e,r=r===void 0?n:~~r,e<0?(e+=n,e<0&&(e=0)):e>n&&(e=n),r<0?(r+=n,r<0&&(r=0)):r>n&&(r=n),r<e&&(r=e);let i=this.subarray(e,r);return Object.setPrototypeOf(i,c.prototype),i};function H(t,e,r){if(t%1!==0||t<0)throw new RangeError("offset is not uint");if(t+e>r)throw new RangeError("Trying to access beyond buffer length")}c.prototype.readUintLE=c.prototype.readUIntLE=function(e,r,n){e=e>>>0,r=r>>>0,n||H(e,r,this.length);let i=this[e],o=1,a=0;for(;++a<r&&(o*=256);)i+=this[e+a]*o;return i};c.prototype.readUintBE=c.prototype.readUIntBE=function(e,r,n){e=e>>>0,r=r>>>0,n||H(e,r,this.length);let i=this[e+--r],o=1;for(;r>0&&(o*=256);)i+=this[e+--r]*o;return i};c.prototype.readUint8=c.prototype.readUInt8=function(e,r){return e=e>>>0,r||H(e,1,this.length),this[e]};c.prototype.readUint16LE=c.prototype.readUInt16LE=function(e,r){return e=e>>>0,r||H(e,2,this.length),this[e]|this[e+1]<<8};c.prototype.readUint16BE=c.prototype.readUInt16BE=function(e,r){return e=e>>>0,r||H(e,2,this.length),this[e]<<8|this[e+1]};c.prototype.readUint32LE=c.prototype.readUInt32LE=function(e,r){return e=e>>>0,r||H(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+this[e+3]*16777216};c.prototype.readUint32BE=c.prototype.readUInt32BE=function(e,r){return e=e>>>0,r||H(e,4,this.length),this[e]*16777216+(this[e+1]<<16|this[e+2]<<8|this[e+3])};c.prototype.readBigUInt64LE=$(function(e){e=e>>>0,te(e,"offset");let r=this[e],n=this[e+7];(r===void 0||n===void 0)&&ce(e,this.length-8);let i=r+this[++e]*2**8+this[++e]*2**16+this[++e]*2**24,o=this[++e]+this[++e]*2**8+this[++e]*2**16+n*2**24;return BigInt(i)+(BigInt(o)<<BigInt(32))});c.prototype.readBigUInt64BE=$(function(e){e=e>>>0,te(e,"offset");let r=this[e],n=this[e+7];(r===void 0||n===void 0)&&ce(e,this.length-8);let i=r*2**24+this[++e]*2**16+this[++e]*2**8+this[++e],o=this[++e]*2**24+this[++e]*2**16+this[++e]*2**8+n;return(BigInt(i)<<BigInt(32))+BigInt(o)});c.prototype.readIntLE=function(e,r,n){e=e>>>0,r=r>>>0,n||H(e,r,this.length);let i=this[e],o=1,a=0;for(;++a<r&&(o*=256);)i+=this[e+a]*o;return o*=128,i>=o&&(i-=Math.pow(2,8*r)),i};c.prototype.readIntBE=function(e,r,n){e=e>>>0,r=r>>>0,n||H(e,r,this.length);let i=r,o=1,a=this[e+--i];for(;i>0&&(o*=256);)a+=this[e+--i]*o;return o*=128,a>=o&&(a-=Math.pow(2,8*r)),a};c.prototype.readInt8=function(e,r){return e=e>>>0,r||H(e,1,this.length),this[e]&128?(255-this[e]+1)*-1:this[e]};c.prototype.readInt16LE=function(e,r){e=e>>>0,r||H(e,2,this.length);let n=this[e]|this[e+1]<<8;return n&32768?n|4294901760:n};c.prototype.readInt16BE=function(e,r){e=e>>>0,r||H(e,2,this.length);let n=this[e+1]|this[e]<<8;return n&32768?n|4294901760:n};c.prototype.readInt32LE=function(e,r){return e=e>>>0,r||H(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24};c.prototype.readInt32BE=function(e,r){return e=e>>>0,r||H(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]};c.prototype.readBigInt64LE=$(function(e){e=e>>>0,te(e,"offset");let r=this[e],n=this[e+7];(r===void 0||n===void 0)&&ce(e,this.length-8);let i=this[e+4]+this[e+5]*2**8+this[e+6]*2**16+(n<<24);return(BigInt(i)<<BigInt(32))+BigInt(r+this[++e]*2**8+this[++e]*2**16+this[++e]*2**24)});c.prototype.readBigInt64BE=$(function(e){e=e>>>0,te(e,"offset");let r=this[e],n=this[e+7];(r===void 0||n===void 0)&&ce(e,this.length-8);let i=(r<<24)+this[++e]*2**16+this[++e]*2**8+this[++e];return(BigInt(i)<<BigInt(32))+BigInt(this[++e]*2**24+this[++e]*2**16+this[++e]*2**8+n)});c.prototype.readFloatLE=function(e,r){return e=e>>>0,r||H(e,4,this.length),ee.read(this,e,!0,23,4)};c.prototype.readFloatBE=function(e,r){return e=e>>>0,r||H(e,4,this.length),ee.read(this,e,!1,23,4)};c.prototype.readDoubleLE=function(e,r){return e=e>>>0,r||H(e,8,this.length),ee.read(this,e,!0,52,8)};c.prototype.readDoubleBE=function(e,r){return e=e>>>0,r||H(e,8,this.length),ee.read(this,e,!1,52,8)};function v(t,e,r,n,i,o){if(!c.isBuffer(t))throw new TypeError('"buffer" argument must be a Buffer instance');if(e>i||e<o)throw new RangeError('"value" argument is out of bounds');if(r+n>t.length)throw new RangeError("Index out of range")}c.prototype.writeUintLE=c.prototype.writeUIntLE=function(e,r,n,i){if(e=+e,r=r>>>0,n=n>>>0,!i){let p=Math.pow(2,8*n)-1;v(this,e,r,n,p,0)}let o=1,a=0;for(this[r]=e&255;++a<n&&(o*=256);)this[r+a]=e/o&255;return r+n};c.prototype.writeUintBE=c.prototype.writeUIntBE=function(e,r,n,i){if(e=+e,r=r>>>0,n=n>>>0,!i){let p=Math.pow(2,8*n)-1;v(this,e,r,n,p,0)}let o=n-1,a=1;for(this[r+o]=e&255;--o>=0&&(a*=256);)this[r+o]=e/a&255;return r+n};c.prototype.writeUint8=c.prototype.writeUInt8=function(e,r,n){return e=+e,r=r>>>0,n||v(this,e,r,1,255,0),this[r]=e&255,r+1};c.prototype.writeUint16LE=c.prototype.writeUInt16LE=function(e,r,n){return e=+e,r=r>>>0,n||v(this,e,r,2,65535,0),this[r]=e&255,this[r+1]=e>>>8,r+2};c.prototype.writeUint16BE=c.prototype.writeUInt16BE=function(e,r,n){return e=+e,r=r>>>0,n||v(this,e,r,2,65535,0),this[r]=e>>>8,this[r+1]=e&255,r+2};c.prototype.writeUint32LE=c.prototype.writeUInt32LE=function(e,r,n){return e=+e,r=r>>>0,n||v(this,e,r,4,4294967295,0),this[r+3]=e>>>24,this[r+2]=e>>>16,this[r+1]=e>>>8,this[r]=e&255,r+4};c.prototype.writeUint32BE=c.prototype.writeUInt32BE=function(e,r,n){return e=+e,r=r>>>0,n||v(this,e,r,4,4294967295,0),this[r]=e>>>24,this[r+1]=e>>>16,this[r+2]=e>>>8,this[r+3]=e&255,r+4};function Bt(t,e,r,n,i){Jt(e,n,i,t,r,7);let o=Number(e&BigInt(4294967295));t[r++]=o,o=o>>8,t[r++]=o,o=o>>8,t[r++]=o,o=o>>8,t[r++]=o;let a=Number(e>>BigInt(32)&BigInt(4294967295));return t[r++]=a,a=a>>8,t[r++]=a,a=a>>8,t[r++]=a,a=a>>8,t[r++]=a,r}function Rt(t,e,r,n,i){Jt(e,n,i,t,r,7);let o=Number(e&BigInt(4294967295));t[r+7]=o,o=o>>8,t[r+6]=o,o=o>>8,t[r+5]=o,o=o>>8,t[r+4]=o;let a=Number(e>>BigInt(32)&BigInt(4294967295));return t[r+3]=a,a=a>>8,t[r+2]=a,a=a>>8,t[r+1]=a,a=a>>8,t[r]=a,r+8}c.prototype.writeBigUInt64LE=$(function(e,r=0){return Bt(this,e,r,BigInt(0),BigInt("0xffffffffffffffff"))});c.prototype.writeBigUInt64BE=$(function(e,r=0){return Rt(this,e,r,BigInt(0),BigInt("0xffffffffffffffff"))});c.prototype.writeIntLE=function(e,r,n,i){if(e=+e,r=r>>>0,!i){let u=Math.pow(2,8*n-1);v(this,e,r,n,u-1,-u)}let o=0,a=1,p=0;for(this[r]=e&255;++o<n&&(a*=256);)e<0&&p===0&&this[r+o-1]!==0&&(p=1),this[r+o]=(e/a>>0)-p&255;return r+n};c.prototype.writeIntBE=function(e,r,n,i){if(e=+e,r=r>>>0,!i){let u=Math.pow(2,8*n-1);v(this,e,r,n,u-1,-u)}let o=n-1,a=1,p=0;for(this[r+o]=e&255;--o>=0&&(a*=256);)e<0&&p===0&&this[r+o+1]!==0&&(p=1),this[r+o]=(e/a>>0)-p&255;return r+n};c.prototype.writeInt8=function(e,r,n){return e=+e,r=r>>>0,n||v(this,e,r,1,127,-128),e<0&&(e=255+e+1),this[r]=e&255,r+1};c.prototype.writeInt16LE=function(e,r,n){return e=+e,r=r>>>0,n||v(this,e,r,2,32767,-32768),this[r]=e&255,this[r+1]=e>>>8,r+2};c.prototype.writeInt16BE=function(e,r,n){return e=+e,r=r>>>0,n||v(this,e,r,2,32767,-32768),this[r]=e>>>8,this[r+1]=e&255,r+2};c.prototype.writeInt32LE=function(e,r,n){return e=+e,r=r>>>0,n||v(this,e,r,4,2147483647,-2147483648),this[r]=e&255,this[r+1]=e>>>8,this[r+2]=e>>>16,this[r+3]=e>>>24,r+4};c.prototype.writeInt32BE=function(e,r,n){return e=+e,r=r>>>0,n||v(this,e,r,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),this[r]=e>>>24,this[r+1]=e>>>16,this[r+2]=e>>>8,this[r+3]=e&255,r+4};c.prototype.writeBigInt64LE=$(function(e,r=0){return Bt(this,e,r,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))});c.prototype.writeBigInt64BE=$(function(e,r=0){return Rt(this,e,r,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))});function Wt(t,e,r,n,i,o){if(r+n>t.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("Index out of range")}function Ut(t,e,r,n,i){return e=+e,r=r>>>0,i||Wt(t,e,r,4,34028234663852886e22,-34028234663852886e22),ee.write(t,e,r,n,23,4),r+4}c.prototype.writeFloatLE=function(e,r,n){return Ut(this,e,r,!0,n)};c.prototype.writeFloatBE=function(e,r,n){return Ut(this,e,r,!1,n)};function Tt(t,e,r,n,i){return e=+e,r=r>>>0,i||Wt(t,e,r,8,17976931348623157e292,-17976931348623157e292),ee.write(t,e,r,n,52,8),r+8}c.prototype.writeDoubleLE=function(e,r,n){return Tt(this,e,r,!0,n)};c.prototype.writeDoubleBE=function(e,r,n){return Tt(this,e,r,!1,n)};c.prototype.copy=function(e,r,n,i){if(!c.isBuffer(e))throw new TypeError("argument should be a Buffer");if(n||(n=0),!i&&i!==0&&(i=this.length),r>=e.length&&(r=e.length),r||(r=0),i>0&&i<n&&(i=n),i===n||e.length===0||this.length===0)return 0;if(r<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("Index out of range");if(i<0)throw new RangeError("sourceEnd out of bounds");i>this.length&&(i=this.length),e.length-r<i-n&&(i=e.length-r+n);let o=i-n;return this===e&&typeof Uint8Array.prototype.copyWithin=="function"?this.copyWithin(r,n,i):Uint8Array.prototype.set.call(e,this.subarray(n,i),r),o};c.prototype.fill=function(e,r,n,i){if(typeof e=="string"){if(typeof r=="string"?(i=r,r=0,n=this.length):typeof n=="string"&&(i=n,n=this.length),i!==void 0&&typeof i!="string")throw new TypeError("encoding must be a string");if(typeof i=="string"&&!c.isEncoding(i))throw new TypeError("Unknown encoding: "+i);if(e.length===1){let a=e.charCodeAt(0);(i==="utf8"&&a<128||i==="latin1")&&(e=a)}}else typeof e=="number"?e=e&255:typeof e=="boolean"&&(e=Number(e));if(r<0||this.length<r||this.length<n)throw new RangeError("Out of range index");if(n<=r)return this;r=r>>>0,n=n===void 0?this.length:n>>>0,e||(e=0);let o;if(typeof e=="number")for(o=r;o<n;++o)this[o]=e;else{let a=c.isBuffer(e)?e:c.from(e,i),p=a.length;if(p===0)throw new TypeError('The value "'+e+'" is invalid for argument "value"');for(o=0;o<n-r;++o)this[o+r]=a[o%p]}return this};var j={};function je(t,e,r){j[t]=class extends r{constructor(){super(),Object.defineProperty(this,"message",{value:e.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${t}]`,this.stack,delete this.name}get code(){return t}set code(i){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:i,writable:!0})}toString(){return`${this.name} [${t}]: ${this.message}`}}}je("ERR_BUFFER_OUT_OF_BOUNDS",function(t){return t?`${t} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError);je("ERR_INVALID_ARG_TYPE",function(t,e){return`The "${t}" argument must be of type number. Received type ${typeof e}`},TypeError);je("ERR_OUT_OF_RANGE",function(t,e,r){let n=`The value of "${t}" is out of range.`,i=r;return Number.isInteger(r)&&Math.abs(r)>2**32?i=Ct(String(r)):typeof r=="bigint"&&(i=String(r),(r>BigInt(2)**BigInt(32)||r<-(BigInt(2)**BigInt(32)))&&(i=Ct(i)),i+="n"),n+=` It must be ${e}. Received ${i}`,n},RangeError);function Ct(t){let e="",r=t.length,n=t[0]==="-"?1:0;for(;r>=n+4;r-=3)e=`_${t.slice(r-3,r)}${e}`;return`${t.slice(0,r)}${e}`}function zr(t,e,r){te(e,"offset"),(t[e]===void 0||t[e+r]===void 0)&&ce(e,t.length-(r+1))}function Jt(t,e,r,n,i,o){if(t>r||t<e){let a=typeof e=="bigint"?"n":"",p;throw o>3?e===0||e===BigInt(0)?p=`>= 0${a} and < 2${a} ** ${(o+1)*8}${a}`:p=`>= -(2${a} ** ${(o+1)*8-1}${a}) and < 2 ** ${(o+1)*8-1}${a}`:p=`>= ${e}${a} and <= ${r}${a}`,new j.ERR_OUT_OF_RANGE("value",p,t)}zr(n,i,o)}function te(t,e){if(typeof t!="number")throw new j.ERR_INVALID_ARG_TYPE(e,"number",t)}function ce(t,e,r){throw Math.floor(t)!==t?(te(t,r),new j.ERR_OUT_OF_RANGE(r||"offset","an integer",t)):e<0?new j.ERR_BUFFER_OUT_OF_BOUNDS:new j.ERR_OUT_OF_RANGE(r||"offset",`>= ${r?1:0} and <= ${e}`,t)}var Yr=/[^+/0-9A-Za-z-_]/g;function Xr(t){if(t=t.split("=")[0],t=t.trim().replace(Yr,""),t.length<2)return"";for(;t.length%4!==0;)t=t+"=";return t}function qe(t,e){e=e||1/0;let r,n=t.length,i=null,o=[];for(let a=0;a<n;++a){if(r=t.charCodeAt(a),r>55295&&r<57344){if(!i){if(r>56319){(e-=3)>-1&&o.push(239,191,189);continue}else if(a+1===n){(e-=3)>-1&&o.push(239,191,189);continue}i=r;continue}if(r<56320){(e-=3)>-1&&o.push(239,191,189),i=r;continue}r=(i-55296<<10|r-56320)+65536}else i&&(e-=3)>-1&&o.push(239,191,189);if(i=null,r<128){if((e-=1)<0)break;o.push(r)}else if(r<2048){if((e-=2)<0)break;o.push(r>>6|192,r&63|128)}else if(r<65536){if((e-=3)<0)break;o.push(r>>12|224,r>>6&63|128,r&63|128)}else if(r<1114112){if((e-=4)<0)break;o.push(r>>18|240,r>>12&63|128,r>>6&63|128,r&63|128)}else throw new Error("Invalid code point")}return o}function qr(t){let e=[];for(let r=0;r<t.length;++r)e.push(t.charCodeAt(r)&255);return e}function Zr(t,e){let r,n,i,o=[];for(let a=0;a<t.length&&!((e-=2)<0);++a)r=t.charCodeAt(a),n=r>>8,i=r%256,o.push(i),o.push(n);return o}function Dt(t){return ze.toByteArray(Xr(t))}function be(t,e,r,n){let i;for(i=0;i<n&&!(i+r>=e.length||i>=t.length);++i)e[i+r]=t[i];return i}function O(t,e){return t instanceof e||t!=null&&t.constructor!=null&&t.constructor.name!=null&&t.constructor.name===e.name}function et(t){return t!==t}var Qr=function(){let t="0123456789abcdef",e=new Array(256);for(let r=0;r<16;++r){let n=r*16;for(let i=0;i<16;++i)e[n+i]=t[r]+t[i]}return e}();function $(t){return typeof BigInt>"u"?jr:t}function jr(){throw new Error("BigInt not supported")}});var d,s=Sr(()=>{d=Ot().Buffer});var Ft=M(tt=>{"use strict";s();Object.defineProperty(tt,"__esModule",{value:!0});function en(t){var e=4,r=t.length,n=r%e;if(!n)return t;var i=r,o=e-n,a=r+o,p=d.alloc(a);for(p.write(t);o--;)p.write("=",i++);return p.toString()}tt.default=en});var Mt=M(it=>{"use strict";s();Object.defineProperty(it,"__esModule",{value:!0});var tn=Ft();function Nt(t,e){return e===void 0&&(e="utf8"),d.isBuffer(t)?rt(t.toString("base64")):rt(d.from(t,e).toString("base64"))}function rn(t,e){return e===void 0&&(e="utf8"),d.from(nt(t),"base64").toString(e)}function nt(t){return t=t.toString(),tn.default(t).replace(/\-/g,"+").replace(/_/g,"/")}function rt(t){return t.replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function nn(t){return d.from(nt(t),"base64")}var ne=Nt;ne.encode=Nt;ne.decode=rn;ne.toBase64=nt;ne.fromBase64=rt;ne.toBuffer=nn;it.default=ne});var kt=M((ii,_e)=>{s();_e.exports=Mt().default;_e.exports.default=_e.exports});var dr=M((ru,pr)=>{"use strict";s();function zn(t,e){return Object.prototype.hasOwnProperty.call(t,e)}pr.exports=function(t,e,r,n){e=e||"&",r=r||"=";var i={};if(typeof t!="string"||t.length===0)return i;var o=/\+/g;t=t.split(e);var a=1e3;n&&typeof n.maxKeys=="number"&&(a=n.maxKeys);var p=t.length;a>0&&p>a&&(p=a);for(var u=0;u<p;++u){var h=t[u].replace(o,"%20"),l=h.indexOf(r),f,A,E,J;l>=0?(f=h.substr(0,l),A=h.substr(l+1)):(f=h,A=""),E=decodeURIComponent(f),J=decodeURIComponent(A),zn(i,E)?Array.isArray(i[E])?i[E].push(J):i[E]=[i[E],J]:i[E]=J}return i}});var fr=M((nu,ur)=>{"use strict";s();var ye=function(t){switch(typeof t){case"string":return t;case"boolean":return t?"true":"false";case"number":return isFinite(t)?t:"";default:return""}};ur.exports=function(t,e,r,n){return e=e||"&",r=r||"=",t===null&&(t=void 0),typeof t=="object"?Object.keys(t).map(function(i){var o=encodeURIComponent(ye(i))+r;return Array.isArray(t[i])?t[i].map(function(a){return o+encodeURIComponent(ye(a))}).join(e):o+encodeURIComponent(ye(t[i]))}).filter(Boolean).join(e):n?encodeURIComponent(ye(n))+r+encodeURIComponent(ye(t)):""}});var lr=M(we=>{"use strict";s();we.decode=we.parse=dr();we.encode=we.stringify=fr()});s();var ge=wt(kt(),1);s();s();s();s();s();s();s();var w=crypto;function x(t){try{return t!=null&&typeof t.extractable=="boolean"&&typeof t.algorithm.name=="string"&&typeof t.type=="string"}catch{return!1}}var on=async(t,e)=>{let r=`SHA-${t.slice(-3)}`;return new Uint8Array(await w.subtle.digest(r,e))},Ce=on;var b=new TextEncoder,I=new TextDecoder,He=2**32;function P(...t){let e=t.reduce((i,{length:o})=>i+o,0),r=new Uint8Array(e),n=0;return t.forEach(i=>{r.set(i,n),n+=i.length}),r}function Lt(t,e){return P(b.encode(t),new Uint8Array([0]),e)}function ot(t,e,r){if(e<0||e>=He)throw new RangeError(`value must be >= 0 and <= ${He-1}. Received ${e}`);t.set([e>>>24,e>>>16,e>>>8,e&255],r)}function at(t){let e=Math.floor(t/He),r=t%He,n=new Uint8Array(8);return ot(n,e,0),ot(n,r,4),n}function Ke(t){let e=new Uint8Array(4);return ot(e,t),e}function Ie(t){return P(Ke(t.length),t)}async function $t(t,e,r){let n=Math.ceil((e>>3)/32),i;for(let o=1;o<=n;o++){let a=new Uint8Array(4+t.length+r.length);a.set(Ke(o)),a.set(t,4),a.set(r,4+t.length),i?i=P(i,await Ce("sha256",a)):i=await Ce("sha256",a)}return i=i.slice(0,e>>3),i}var st=t=>{let e=t;typeof e=="string"&&(e=b.encode(e));let r=32768,n=[];for(let i=0;i<e.length;i+=r)n.push(String.fromCharCode.apply(null,e.subarray(i,i+r)));return btoa(n.join(""))},B=t=>st(t).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_"),Gt=t=>new Uint8Array(atob(t).split("").map(e=>e.charCodeAt(0))),_=t=>{let e=t;e instanceof Uint8Array&&(e=I.decode(e)),e=e.replace(/-/g,"+").replace(/_/g,"/").replace(/\s/g,"");try{return Gt(e)}catch{throw new TypeError("The input to be decoded is not correctly encoded.")}};s();s();s();var L=class extends Error{constructor(e){var r;super(e),this.code="ERR_JOSE_GENERIC",this.name=this.constructor.name,(r=Error.captureStackTrace)===null||r===void 0||r.call(Error,this,this.constructor)}static get code(){return"ERR_JOSE_GENERIC"}};var ie=class extends L{constructor(){super(...arguments),this.code="ERR_JOSE_ALG_NOT_ALLOWED"}static get code(){return"ERR_JOSE_ALG_NOT_ALLOWED"}},y=class extends L{constructor(){super(...arguments),this.code="ERR_JOSE_NOT_SUPPORTED"}static get code(){return"ERR_JOSE_NOT_SUPPORTED"}},Y=class extends L{constructor(){super(...arguments),this.code="ERR_JWE_DECRYPTION_FAILED",this.message="decryption operation failed"}static get code(){return"ERR_JWE_DECRYPTION_FAILED"}},m=class extends L{constructor(){super(...arguments),this.code="ERR_JWE_INVALID"}static get code(){return"ERR_JWE_INVALID"}},R=class extends L{constructor(){super(...arguments),this.code="ERR_JWS_INVALID"}static get code(){return"ERR_JWS_INVALID"}},G=class extends L{constructor(){super(...arguments),this.code="ERR_JWT_INVALID"}static get code(){return"ERR_JWT_INVALID"}};s();s();var pe=w.getRandomValues.bind(w);function zt(t){switch(t){case"A128GCM":case"A128GCMKW":case"A192GCM":case"A192GCMKW":case"A256GCM":case"A256GCMKW":return 96;case"A128CBC-HS256":case"A192CBC-HS384":case"A256CBC-HS512":return 128;default:throw new y(`Unsupported JWE Algorithm: ${t}`)}}var sn=(t,e)=>{if(e.length<<3!==zt(t))throw new m("Invalid Initialization Vector length")},ct=sn;s();var cn=(t,e)=>{if(t.length<<3!==e)throw new m("Invalid Content Encryption Key length")},Pe=cn;s();var pn=(t,e)=>{if(!(t instanceof Uint8Array))throw new TypeError("First argument must be a buffer");if(!(e instanceof Uint8Array))throw new TypeError("Second argument must be a buffer");if(t.length!==e.length)throw new TypeError("Input buffers must have the same length");let r=t.length,n=0,i=-1;for(;++i<r;)n|=t[i]^e[i];return n===0},Yt=pn;s();s();function F(){return typeof WebSocketPair=="function"}function T(){try{return process.versions.node!==void 0}catch{return!1}}function K(t,e="algorithm.name"){return new TypeError(`CryptoKey does not support this operation, its ${e} must be ${t}`)}function N(t,e){return t.name===e}function ve(t){return parseInt(t.name.slice(4),10)}function dn(t){switch(t){case"ES256":return"P-256";case"ES384":return"P-384";case"ES512":return"P-521";default:throw new Error("unreachable")}}function Xt(t,e){if(e.length&&!e.some(r=>t.usages.includes(r))){let r="CryptoKey does not support this operation, its usages must include ";if(e.length>2){let n=e.pop();r+=`one of ${e.join(", ")}, or ${n}.`}else e.length===2?r+=`one of ${e[0]} or ${e[1]}.`:r+=`${e[0]}.`;throw new TypeError(r)}}function qt(t,e,...r){switch(e){case"HS256":case"HS384":case"HS512":{if(!N(t.algorithm,"HMAC"))throw K("HMAC");let n=parseInt(e.slice(2),10);if(ve(t.algorithm.hash)!==n)throw K(`SHA-${n}`,"algorithm.hash");break}case"RS256":case"RS384":case"RS512":{if(!N(t.algorithm,"RSASSA-PKCS1-v1_5"))throw K("RSASSA-PKCS1-v1_5");let n=parseInt(e.slice(2),10);if(ve(t.algorithm.hash)!==n)throw K(`SHA-${n}`,"algorithm.hash");break}case"PS256":case"PS384":case"PS512":{if(!N(t.algorithm,"RSA-PSS"))throw K("RSA-PSS");let n=parseInt(e.slice(2),10);if(ve(t.algorithm.hash)!==n)throw K(`SHA-${n}`,"algorithm.hash");break}case(T()&&"EdDSA"):{if(t.algorithm.name!=="NODE-ED25519"&&t.algorithm.name!=="NODE-ED448")throw K("NODE-ED25519 or NODE-ED448");break}case(F()&&"EdDSA"):{if(!N(t.algorithm,"NODE-ED25519"))throw K("NODE-ED25519");break}case"ES256":case"ES384":case"ES512":{if(!N(t.algorithm,"ECDSA"))throw K("ECDSA");let n=dn(e);if(t.algorithm.namedCurve!==n)throw K(n,"algorithm.namedCurve");break}default:throw new TypeError("CryptoKey does not support this operation")}Xt(t,r)}function U(t,e,...r){switch(e){case"A128GCM":case"A192GCM":case"A256GCM":{if(!N(t.algorithm,"AES-GCM"))throw K("AES-GCM");let n=parseInt(e.slice(1,4),10);if(t.algorithm.length!==n)throw K(n,"algorithm.length");break}case"A128KW":case"A192KW":case"A256KW":{if(!N(t.algorithm,"AES-KW"))throw K("AES-KW");let n=parseInt(e.slice(1,4),10);if(t.algorithm.length!==n)throw K(n,"algorithm.length");break}case"ECDH":if(!N(t.algorithm,"ECDH"))throw K("ECDH");break;case"PBES2-HS256+A128KW":case"PBES2-HS384+A192KW":case"PBES2-HS512+A256KW":if(!N(t.algorithm,"PBKDF2"))throw K("PBKDF2");break;case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":{if(!N(t.algorithm,"RSA-OAEP"))throw K("RSA-OAEP");let n=parseInt(e.slice(9),10)||1;if(ve(t.algorithm.hash)!==n)throw K(`SHA-${n}`,"algorithm.hash");break}default:throw new TypeError("CryptoKey does not support this operation")}Xt(t,r)}s();var S=(t,...e)=>{let r="Key must be ";if(e.length>2){let n=e.pop();r+=`one of type ${e.join(", ")}, or ${n}.`}else e.length===2?r+=`one of type ${e[0]} or ${e[1]}.`:r+=`of type ${e[0]}.`;return t==null?r+=` Received ${t}`:typeof t=="function"&&t.name?r+=` Received function ${t.name}`:typeof t=="object"&&t!=null&&t.constructor&&t.constructor.name&&(r+=` Received an instance of ${t.constructor.name}`),r};s();var pt=t=>x(t),g=["CryptoKey"];async function un(t,e,r,n,i,o){if(!(e instanceof Uint8Array))throw new TypeError(S(e,"Uint8Array"));let a=parseInt(t.slice(1,4),10),p=await w.subtle.importKey("raw",e.subarray(a>>3),"AES-CBC",!1,["decrypt"]),u=await w.subtle.importKey("raw",e.subarray(0,a>>3),{hash:`SHA-${a<<1}`,name:"HMAC"},!1,["sign"]),h=P(o,n,r,at(o.length<<3)),l=new Uint8Array((await w.subtle.sign("HMAC",u,h)).slice(0,a>>3)),f;try{f=Yt(i,l)}catch{}if(!f)throw new Y;let A;try{A=new Uint8Array(await w.subtle.decrypt({iv:n,name:"AES-CBC"},p,r))}catch{}if(!A)throw new Y;return A}async function fn(t,e,r,n,i,o){let a;e instanceof Uint8Array?a=await w.subtle.importKey("raw",e,"AES-GCM",!1,["decrypt"]):(U(e,t,"decrypt"),a=e);try{return new Uint8Array(await w.subtle.decrypt({additionalData:o,iv:n,name:"AES-GCM",tagLength:128},a,P(r,i)))}catch{throw new Y}}var ln=async(t,e,r,n,i,o)=>{if(!x(e)&&!(e instanceof Uint8Array))throw new TypeError(S(e,...g,"Uint8Array"));switch(ct(t,n),t){case"A128CBC-HS256":case"A192CBC-HS384":case"A256CBC-HS512":return e instanceof Uint8Array&&Pe(e,parseInt(t.slice(-3),10)),un(t,e,r,n,i,o);case"A128GCM":case"A192GCM":case"A256GCM":return e instanceof Uint8Array&&Pe(e,parseInt(t.slice(1,4),10)),fn(t,e,r,n,i,o);default:throw new y("Unsupported JWE Content Encryption Algorithm")}},Be=ln;s();var Zt=async()=>{throw new y('JWE "zip" (Compression Algorithm) Header Parameter is not supported by your javascript runtime. You need to use the `inflateRaw` decrypt option to provide Inflate Raw implementation.')};s();var hn=(...t)=>{let e=t.filter(Boolean);if(e.length===0||e.length===1)return!0;let r;for(let n of e){let i=Object.keys(n);if(!r||r.size===0){r=new Set(i);continue}for(let o of i){if(r.has(o))return!1;r.add(o)}}return!0},X=hn;s();function mn(t){return typeof t=="object"&&t!==null}function C(t){if(!mn(t)||Object.prototype.toString.call(t)!=="[object Object]")return!1;if(Object.getPrototypeOf(t)===null)return!0;let e=t;for(;Object.getPrototypeOf(e)!==null;)e=Object.getPrototypeOf(e);return Object.getPrototypeOf(t)===e}s();s();s();var yn=[{hash:"SHA-256",name:"HMAC"},!0,["sign"]],Re=yn;function wn(t,e){if(t.algorithm.length!==parseInt(e.slice(1,4),10))throw new TypeError(`Invalid key size for alg: ${e}`)}function gn(t,e,r){if(x(t))return U(t,e,r),t;if(t instanceof Uint8Array)return w.subtle.importKey("raw",t,"AES-KW",!0,[r]);throw new TypeError(S(t,...g,"Uint8Array"))}var de=async(t,e,r)=>{let n=await gn(e,t,"unwrapKey");wn(n,t);let i=await w.subtle.unwrapKey("raw",r,n,"AES-KW",...Re);return new Uint8Array(await w.subtle.exportKey("raw",i))};s();async function dt(t,e,r,n,i=new Uint8Array(0),o=new Uint8Array(0)){if(!x(t))throw new TypeError(S(t,...g));if(U(t,"ECDH"),!x(e))throw new TypeError(S(e,...g));U(e,"ECDH","deriveBits");let a=P(Ie(b.encode(r)),Ie(i),Ie(o),Ke(n)),p=new Uint8Array(await w.subtle.deriveBits({name:"ECDH",public:t},e,Math.ceil(parseInt(e.algorithm.namedCurve.slice(-3),10)/8)<<3));return $t(p,n,a)}function ut(t){if(!x(t))throw new TypeError(S(t,...g));return["P-256","P-384","P-521"].includes(t.algorithm.namedCurve)}s();s();function ft(t){if(!(t instanceof Uint8Array)||t.length<8)throw new m("PBES2 Salt Input must be 8 or more octets")}function Sn(t,e){if(t instanceof Uint8Array)return w.subtle.importKey("raw",t,"PBKDF2",!1,["deriveBits"]);if(x(t))return U(t,e,"deriveBits","deriveKey"),t;throw new TypeError(S(t,...g,"Uint8Array"))}async function An(t,e,r,n){ft(t);let i=Lt(e,t),o=parseInt(e.slice(13,16),10),a={hash:`SHA-${e.slice(8,11)}`,iterations:r,name:"PBKDF2",salt:i},p={length:o,name:"AES-KW"},u=await Sn(n,e);if(u.usages.includes("deriveBits"))return new Uint8Array(await w.subtle.deriveBits(a,u,o));if(u.usages.includes("deriveKey"))return w.subtle.deriveKey(a,u,p,!1,["wrapKey","unwrapKey"]);throw new TypeError('PBKDF2 key "usages" must include "deriveBits" or "deriveKey"')}var jt=async(t,e,r,n,i)=>{let o=await An(i,t,n,e);return de(t.slice(-6),o,r)};s();s();function We(t){switch(t){case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":return"RSA-OAEP";default:throw new y(`alg ${t} is not supported either by JOSE or your javascript runtime`)}}s();var ue=(t,e)=>{if(t.startsWith("RS")||t.startsWith("PS")){let{modulusLength:r}=e.algorithm;if(typeof r!="number"||r<2048)throw new TypeError(`${t} requires key modulusLength to be 2048 bits or larger`)}};var er=async(t,e,r)=>{if(!x(e))throw new TypeError(S(e,...g));if(U(e,t,"decrypt","unwrapKey"),ue(t,e),e.usages.includes("decrypt"))return new Uint8Array(await w.subtle.decrypt(We(t),e,r));if(e.usages.includes("unwrapKey")){let n=await w.subtle.unwrapKey("raw",r,e,We(t),...Re);return new Uint8Array(await w.subtle.exportKey("raw",n))}throw new TypeError('RSA-OAEP key "usages" must include "decrypt" or "unwrapKey" for this operation')};s();function Ue(t){switch(t){case"A128GCM":return 128;case"A192GCM":return 192;case"A256GCM":case"A128CBC-HS256":return 256;case"A192CBC-HS384":return 384;case"A256CBC-HS512":return 512;default:throw new y(`Unsupported JWE Algorithm: ${t}`)}}var Te=t=>pe(new Uint8Array(Ue(t)>>3));s();s();s();s();function bn(t){let e,r;switch(t.kty){case"oct":{switch(t.alg){case"HS256":case"HS384":case"HS512":e={name:"HMAC",hash:`SHA-${t.alg.slice(-3)}`},r=["sign","verify"];break;case"A128CBC-HS256":case"A192CBC-HS384":case"A256CBC-HS512":throw new y(`${t.alg} keys cannot be imported as CryptoKey instances`);case"A128GCM":case"A192GCM":case"A256GCM":case"A128GCMKW":case"A192GCMKW":case"A256GCMKW":e={name:"AES-GCM"},r=["encrypt","decrypt"];break;case"A128KW":case"A192KW":case"A256KW":e={name:"AES-KW"},r=["wrapKey","unwrapKey"];break;case"PBES2-HS256+A128KW":case"PBES2-HS384+A192KW":case"PBES2-HS512+A256KW":e={name:"PBKDF2"},r=["deriveBits"];break;default:throw new y('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break}case"RSA":{switch(t.alg){case"PS256":case"PS384":case"PS512":e={name:"RSA-PSS",hash:`SHA-${t.alg.slice(-3)}`},r=t.d?["sign"]:["verify"];break;case"RS256":case"RS384":case"RS512":e={name:"RSASSA-PKCS1-v1_5",hash:`SHA-${t.alg.slice(-3)}`},r=t.d?["sign"]:["verify"];break;case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":e={name:"RSA-OAEP",hash:`SHA-${parseInt(t.alg.slice(-3),10)||1}`},r=t.d?["decrypt","unwrapKey"]:["encrypt","wrapKey"];break;default:throw new y('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break}case"EC":{switch(t.alg){case"ES256":e={name:"ECDSA",namedCurve:"P-256"},r=t.d?["sign"]:["verify"];break;case"ES384":e={name:"ECDSA",namedCurve:"P-384"},r=t.d?["sign"]:["verify"];break;case"ES512":e={name:"ECDSA",namedCurve:"P-521"},r=t.d?["sign"]:["verify"];break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":e={name:"ECDH",namedCurve:t.crv},r=t.d?["deriveBits"]:[];break;default:throw new y('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break}case((F()||T())&&"OKP"):if(t.alg!=="EdDSA")throw new y('Invalid or unsupported JWK "alg" (Algorithm) Parameter value');switch(t.crv){case"Ed25519":e={name:"NODE-ED25519",namedCurve:"NODE-ED25519"},r=t.d?["sign"]:["verify"];break;case(T()&&"Ed448"):e={name:"NODE-ED448",namedCurve:"NODE-ED448"},r=t.d?["sign"]:["verify"];break;default:throw new y('Invalid or unsupported JWK "crv" (Subtype of Key Pair) Parameter value')}break;default:throw new y('Invalid or unsupported JWK "kty" (Key Type) Parameter value')}return{algorithm:e,keyUsages:r}}var _n=async t=>{var e,r;let{algorithm:n,keyUsages:i}=bn(t),o=[n,(e=t.ext)!==null&&e!==void 0?e:!1,(r=t.key_ops)!==null&&r!==void 0?r:i];if(n.name==="PBKDF2")return w.subtle.importKey("raw",_(t.k),...o);let a={...t};return delete a.alg,w.subtle.importKey("jwk",a,...o)},lt=_n;async function q(t,e,r){if(!C(t))throw new TypeError("JWK must be an object");if(e||(e=t.alg),typeof e!="string"||!e)throw new TypeError('"alg" argument is required when "jwk.alg" is not present');switch(t.kty){case"oct":if(typeof t.k!="string"||!t.k)throw new TypeError('missing "k" (Key Value) Parameter value');return r??(r=t.ext!==!0),r?lt({...t,alg:e,ext:!1}):_(t.k);case"RSA":if(t.oth!==void 0)throw new y('RSA JWK "oth" (Other Primes Info) Parameter value is not supported');case"EC":case"OKP":return lt({...t,alg:e});default:throw new y('Unsupported "kty" (Key Type) Parameter value')}}s();var Cn=t=>{if(!(t instanceof Uint8Array)){if(!pt(t))throw new TypeError(S(t,...g,"Uint8Array"));if(t.type!=="secret")throw new TypeError(`${g.join(" or ")} instances for symmetric algorithms must be of type "secret"`)}},Hn=(t,e)=>{if(!pt(t))throw new TypeError(S(t,...g));if(t.type==="secret")throw new TypeError(`${g.join(" or ")} instances for asymmetric algorithms must not be of type "secret"`);if(e==="sign"&&t.type==="public")throw new TypeError(`${g.join(" or ")} instances for asymmetric algorithm signing must be of type "private"`);if(e==="decrypt"&&t.type==="public")throw new TypeError(`${g.join(" or ")} instances for asymmetric algorithm decryption must be of type "private"`);if(t.algorithm&&e==="verify"&&t.type==="private")throw new TypeError(`${g.join(" or ")} instances for asymmetric algorithm verifying must be of type "public"`);if(t.algorithm&&e==="encrypt"&&t.type==="private")throw new TypeError(`${g.join(" or ")} instances for asymmetric algorithm encryption must be of type "public"`)},Kn=(t,e,r)=>{t.startsWith("HS")||t==="dir"||t.startsWith("PBES2")||/^A\d{3}(?:GCM)?KW$/.test(t)?Cn(e):Hn(e,r)},oe=Kn;s();s();async function tr(t,e,r,n,i){let o=t.slice(0,7);return Be(o,e,r,n,i,new Uint8Array(0))}async function vn(t,e,r,n){switch(oe(t,e,"decrypt"),t){case"dir":{if(r!==void 0)throw new m("Encountered unexpected JWE Encrypted Key");return e}case"ECDH-ES":if(r!==void 0)throw new m("Encountered unexpected JWE Encrypted Key");case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":{if(!C(n.epk))throw new m('JOSE Header "epk" (Ephemeral Public Key) missing or invalid');if(!ut(e))throw new y("ECDH with the provided key is not allowed or not supported by your javascript runtime");let i=await q(n.epk,t),o,a;if(n.apu!==void 0){if(typeof n.apu!="string")throw new m('JOSE Header "apu" (Agreement PartyUInfo) invalid');o=_(n.apu)}if(n.apv!==void 0){if(typeof n.apv!="string")throw new m('JOSE Header "apv" (Agreement PartyVInfo) invalid');a=_(n.apv)}let p=await dt(i,e,t==="ECDH-ES"?n.enc:t,t==="ECDH-ES"?Ue(n.enc):parseInt(t.slice(-5,-2),10),o,a);if(t==="ECDH-ES")return p;if(r===void 0)throw new m("JWE Encrypted Key missing");return de(t.slice(-6),p,r)}case"RSA1_5":case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":{if(r===void 0)throw new m("JWE Encrypted Key missing");return er(t,e,r)}case"PBES2-HS256+A128KW":case"PBES2-HS384+A192KW":case"PBES2-HS512+A256KW":{if(r===void 0)throw new m("JWE Encrypted Key missing");if(typeof n.p2c!="number")throw new m('JOSE Header "p2c" (PBES2 Count) missing or invalid');if(typeof n.p2s!="string")throw new m('JOSE Header "p2s" (PBES2 Salt) missing or invalid');return jt(t,e,r,n.p2c,_(n.p2s))}case"A128KW":case"A192KW":case"A256KW":{if(r===void 0)throw new m("JWE Encrypted Key missing");return de(t,e,r)}case"A128GCMKW":case"A192GCMKW":case"A256GCMKW":{if(r===void 0)throw new m("JWE Encrypted Key missing");if(typeof n.iv!="string")throw new m('JOSE Header "iv" (Initialization Vector) missing or invalid');if(typeof n.tag!="string")throw new m('JOSE Header "tag" (Authentication Tag) missing or invalid');let i=_(n.iv),o=_(n.tag);return tr(t,e,r,i,o)}default:throw new y('Invalid or unsupported "alg" (JWE Algorithm) header value')}}var rr=vn;s();function Bn(t,e,r,n,i){if(i.crit!==void 0&&n.crit===void 0)throw new t('"crit" (Critical) Header Parameter MUST be integrity protected');if(!n||n.crit===void 0)return new Set;if(!Array.isArray(n.crit)||n.crit.length===0||n.crit.some(a=>typeof a!="string"||a.length===0))throw new t('"crit" (Critical) Header Parameter MUST be an array of non-empty strings when present');let o;r!==void 0?o=new Map([...Object.entries(r),...e.entries()]):o=e;for(let a of n.crit){if(!o.has(a))throw new y(`Extension Header Parameter "${a}" is not recognized`);if(i[a]===void 0)throw new t(`Extension Header Parameter "${a}" is missing`);if(o.get(a)&&n[a]===void 0)throw new t(`Extension Header Parameter "${a}" MUST be integrity protected`)}return new Set(n.crit)}var Z=Bn;s();var Rn=(t,e)=>{if(e!==void 0&&(!Array.isArray(e)||e.some(r=>typeof r!="string")))throw new TypeError(`"${t}" option must be an array of strings`);if(!!e)return new Set(e)},Je=Rn;async function De(t,e,r){var n;if(!C(t))throw new m("Flattened JWE must be an object");if(t.protected===void 0&&t.header===void 0&&t.unprotected===void 0)throw new m("JOSE Header missing");if(typeof t.iv!="string")throw new m("JWE Initialization Vector missing or incorrect type");if(typeof t.ciphertext!="string")throw new m("JWE Ciphertext missing or incorrect type");if(typeof t.tag!="string")throw new m("JWE Authentication Tag missing or incorrect type");if(t.protected!==void 0&&typeof t.protected!="string")throw new m("JWE Protected Header incorrect type");if(t.encrypted_key!==void 0&&typeof t.encrypted_key!="string")throw new m("JWE Encrypted Key incorrect type");if(t.aad!==void 0&&typeof t.aad!="string")throw new m("JWE AAD incorrect type");if(t.header!==void 0&&!C(t.header))throw new m("JWE Shared Unprotected Header incorrect type");if(t.unprotected!==void 0&&!C(t.unprotected))throw new m("JWE Per-Recipient Unprotected Header incorrect type");let i;if(t.protected){let Se=_(t.protected);try{i=JSON.parse(I.decode(Se))}catch{throw new m("JWE Protected Header is invalid")}}if(!X(i,t.header,t.unprotected))throw new m("JWE Protected, JWE Unprotected Header, and JWE Per-Recipient Unprotected Header Parameter names must be disjoint");let o={...i,...t.header,...t.unprotected};if(Z(m,new Map,r?.crit,i,o),o.zip!==void 0){if(!i||!i.zip)throw new m('JWE "zip" (Compression Algorithm) Header MUST be integrity protected');if(o.zip!=="DEF")throw new y('Unsupported JWE "zip" (Compression Algorithm) Header Parameter value')}let{alg:a,enc:p}=o;if(typeof a!="string"||!a)throw new m("missing JWE Algorithm (alg) in JWE Header");if(typeof p!="string"||!p)throw new m("missing JWE Encryption Algorithm (enc) in JWE Header");let u=r&&Je("keyManagementAlgorithms",r.keyManagementAlgorithms),h=r&&Je("contentEncryptionAlgorithms",r.contentEncryptionAlgorithms);if(u&&!u.has(a))throw new ie('"alg" (Algorithm) Header Parameter not allowed');if(h&&!h.has(p))throw new ie('"enc" (Encryption Algorithm) Header Parameter not allowed');let l;t.encrypted_key!==void 0&&(l=_(t.encrypted_key));let f=!1;typeof e=="function"&&(e=await e(i,t),f=!0);let A;try{A=await rr(a,e,l,o)}catch(Se){if(Se instanceof TypeError)throw Se;A=Te(p)}let E=_(t.iv),J=_(t.tag),Ee=b.encode((n=t.protected)!==null&&n!==void 0?n:""),Le;t.aad!==void 0?Le=P(Ee,b.encode("."),b.encode(t.aad)):Le=Ee;let $e=await Be(p,A,_(t.ciphertext),E,J,Le);o.zip==="DEF"&&($e=await(r?.inflateRaw||Zt)($e));let Q={plaintext:$e};return t.protected!==void 0&&(Q.protectedHeader=i),t.aad!==void 0&&(Q.additionalAuthenticatedData=_(t.aad)),t.unprotected!==void 0&&(Q.sharedUnprotectedHeader=t.unprotected),t.header!==void 0&&(Q.unprotectedHeader=t.header),f?{...Q,key:e}:Q}async function Oe(t,e,r){if(t instanceof Uint8Array&&(t=I.decode(t)),typeof t!="string")throw new m("Compact JWE must be a string or Uint8Array");let{0:n,1:i,2:o,3:a,4:p,length:u}=t.split(".");if(u!==5)throw new m("Invalid Compact JWE");let h=await De({ciphertext:a,iv:o||void 0,protected:n||void 0,tag:p||void 0,encrypted_key:i||void 0},e,r),l={plaintext:h.plaintext,protectedHeader:h.protectedHeader};return typeof e=="function"?{...l,key:h.key}:l}s();s();s();s();s();s();var Wn=async t=>{if(t instanceof Uint8Array)return{kty:"oct",k:B(t)};if(!x(t))throw new TypeError(S(t,...g,"Uint8Array"));if(!t.extractable)throw new TypeError("non-extractable CryptoKey cannot be exported as a JWK");let{ext:e,key_ops:r,alg:n,use:i,...o}=await w.subtle.exportKey("jwk",t);return o},nr=Wn;async function fe(t){return nr(t)}var Tn=Symbol();s();s();s();s();function Fe(t,e){let r=`SHA-${t.slice(-3)}`;switch(t){case"HS256":case"HS384":case"HS512":return{hash:r,name:"HMAC"};case"PS256":case"PS384":case"PS512":return{hash:r,name:"RSA-PSS",saltLength:t.slice(-3)>>3};case"RS256":case"RS384":case"RS512":return{hash:r,name:"RSASSA-PKCS1-v1_5"};case"ES256":case"ES384":case"ES512":return{hash:r,name:"ECDSA",namedCurve:e.namedCurve};case((F()||T())&&"EdDSA"):let{namedCurve:n}=e;return{name:n,namedCurve:n};default:throw new y(`alg ${t} is not supported either by JOSE or your javascript runtime`)}}s();function Ne(t,e,r){if(x(e))return qt(e,t,r),e;if(e instanceof Uint8Array){if(!t.startsWith("HS"))throw new TypeError(S(e,...g));return w.subtle.importKey("raw",e,{hash:`SHA-${t.slice(-3)}`,name:"HMAC"},!1,[r])}throw new TypeError(S(e,...g,"Uint8Array"))}s();s();s();s();var le=t=>Math.floor(t.getTime()/1e3);s();var Dn=/^(\d+|\d+\.\d+) ?(seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)$/i,Me=t=>{let e=Dn.exec(t);if(!e)throw new TypeError("Invalid time period format");let r=parseFloat(e[1]);switch(e[2].toLowerCase()){case"sec":case"secs":case"second":case"seconds":case"s":return Math.round(r);case"minute":case"minutes":case"min":case"mins":case"m":return Math.round(r*60);case"hour":case"hours":case"hr":case"hrs":case"h":return Math.round(r*3600);case"day":case"days":case"d":return Math.round(r*86400);case"week":case"weeks":case"w":return Math.round(r*604800);default:return Math.round(r*31557600)}};s();s();s();s();s();var Nn=async(t,e,r)=>{let n=await Ne(t,e,"sign");ue(t,n);let i=await w.subtle.sign(Fe(t,n.algorithm),n,r);return new Uint8Array(i)},sr=Nn;var ae=class{constructor(e){if(!(e instanceof Uint8Array))throw new TypeError("payload must be an instance of Uint8Array");this._payload=e}setProtectedHeader(e){if(this._protectedHeader)throw new TypeError("setProtectedHeader can only be called once");return this._protectedHeader=e,this}setUnprotectedHeader(e){if(this._unprotectedHeader)throw new TypeError("setUnprotectedHeader can only be called once");return this._unprotectedHeader=e,this}async sign(e,r){if(!this._protectedHeader&&!this._unprotectedHeader)throw new R("either setProtectedHeader or setUnprotectedHeader must be called before #sign()");if(!X(this._protectedHeader,this._unprotectedHeader))throw new R("JWS Protected and JWS Unprotected Header Parameter names must be disjoint");let n={...this._protectedHeader,...this._unprotectedHeader},i=Z(R,new Map([["b64",!0]]),r?.crit,this._protectedHeader,n),o=!0;if(i.has("b64")&&(o=this._protectedHeader.b64,typeof o!="boolean"))throw new R('The "b64" (base64url-encode payload) Header Parameter must be a boolean');let{alg:a}=n;if(typeof a!="string"||!a)throw new R('JWS "alg" (Algorithm) Header Parameter missing or invalid');oe(a,e,"sign");let p=this._payload;o&&(p=b.encode(B(p)));let u;this._protectedHeader?u=b.encode(B(JSON.stringify(this._protectedHeader))):u=b.encode("");let h=P(u,b.encode("."),p),l=await sr(a,e,h),f={signature:B(l),payload:""};return o&&(f.payload=I.decode(p)),this._unprotectedHeader&&(f.header=this._unprotectedHeader),this._protectedHeader&&(f.protected=I.decode(u)),f}};var he=class{constructor(e){this._flattened=new ae(e)}setProtectedHeader(e){return this._flattened.setProtectedHeader(e),this}async sign(e,r){let n=await this._flattened.sign(e,r);if(n.payload===void 0)throw new TypeError("use the flattened module for creating JWS with b64: false");return`${n.protected}.${n.payload}.${n.signature}`}};s();s();s();var se=class{constructor(e){if(!C(e))throw new TypeError("JWT Claims Set MUST be an object");this._payload=e}setIssuer(e){return this._payload={...this._payload,iss:e},this}setSubject(e){return this._payload={...this._payload,sub:e},this}setAudience(e){return this._payload={...this._payload,aud:e},this}setJti(e){return this._payload={...this._payload,jti:e},this}setNotBefore(e){return typeof e=="number"?this._payload={...this._payload,nbf:e}:this._payload={...this._payload,nbf:le(new Date)+Me(e)},this}setExpirationTime(e){return typeof e=="number"?this._payload={...this._payload,exp:e}:this._payload={...this._payload,exp:le(new Date)+Me(e)},this}setIssuedAt(e){return typeof e>"u"?this._payload={...this._payload,iat:le(new Date)}:this._payload={...this._payload,iat:e},this}};var me=class extends se{setProtectedHeader(e){return this._protectedHeader=e,this}async sign(e,r){var n;let i=new he(b.encode(JSON.stringify(this._payload)));if(i.setProtectedHeader(this._protectedHeader),Array.isArray((n=this._protectedHeader)===null||n===void 0?void 0:n.crit)&&this._protectedHeader.crit.includes("b64")&&this._protectedHeader.b64===!1)throw new G("JWTs MUST NOT use unencoded payload");return i.sign(e,r)}};s();s();s();s();s();s();s();s();s();s();s();s();function ht(t){var e;let r=(e=t?.modulusLength)!==null&&e!==void 0?e:2048;if(typeof r!="number"||r<2048)throw new y("Invalid or unsupported modulusLength option provided, 2048 bits or larger keys must be used");return r}async function cr(t,e){var r,n;let i,o;switch(t){case"PS256":case"PS384":case"PS512":i={name:"RSA-PSS",hash:`SHA-${t.slice(-3)}`,publicExponent:new Uint8Array([1,0,1]),modulusLength:ht(e)},o=["sign","verify"];break;case"RS256":case"RS384":case"RS512":i={name:"RSASSA-PKCS1-v1_5",hash:`SHA-${t.slice(-3)}`,publicExponent:new Uint8Array([1,0,1]),modulusLength:ht(e)},o=["sign","verify"];break;case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":i={name:"RSA-OAEP",hash:`SHA-${parseInt(t.slice(-3),10)||1}`,publicExponent:new Uint8Array([1,0,1]),modulusLength:ht(e)},o=["decrypt","unwrapKey","encrypt","wrapKey"];break;case"ES256":i={name:"ECDSA",namedCurve:"P-256"},o=["sign","verify"];break;case"ES384":i={name:"ECDSA",namedCurve:"P-384"},o=["sign","verify"];break;case"ES512":i={name:"ECDSA",namedCurve:"P-521"},o=["sign","verify"];break;case((F()||T())&&"EdDSA"):switch(e?.crv){case void 0:case"Ed25519":i={name:"NODE-ED25519",namedCurve:"NODE-ED25519"},o=["sign","verify"];break;case(T()&&"Ed448"):i={name:"NODE-ED448",namedCurve:"NODE-ED448"},o=["sign","verify"];break;default:throw new y("Invalid or unsupported crv option provided, supported values are Ed25519 and Ed448")}break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":i={name:"ECDH",namedCurve:(r=e?.crv)!==null&&r!==void 0?r:"P-256"},o=["deriveKey","deriveBits"];break;default:throw new y('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}return w.subtle.generateKey(i,(n=e?.extractable)!==null&&n!==void 0?n:!1,o)}async function mt(t,e){return cr(t,e)}s();var hr=wt(lr(),1);function Yn(t){let e=new Uint8Array(t);return crypto.getRandomValues(e),ge.default.encode(e.buffer)}function ke(t){return JSON.parse(ge.default.decode(t))}function ou(t){return JSON.parse(new TextDecoder().decode(t))}async function au(t){let e=t.shl.split(/^(?:.+:\/.+#)?shlink:\//)[1];return ke(e)?.flags}async function su(t){let e=t.shl.split(/^(?:.+:\/.+#)?shlink:\//)[1];return!!ke(e).flags?.includes("P")}async function cu(t){let e=t.shl.split(/^(?:.+:\/.+#)?shlink:\//)[1],r=ke(e),n=await mt("ES256",{extractable:!0}),o=await(await fetch(`${r.oauth.url}/.well-known/smart-configuration`)).json(),p=await(await fetch(`${o.registration_endpoint}`,{method:"POST",headers:{"content-type":"application/json",authorization:`Bearer ${r.oauth.token}`,...t.pin?{"shlink-pin":t.pin}:{}},body:JSON.stringify({token_endpoint_auth_method:"private_key_jwt",grant_types:["client_credentials"],jwks:{keys:[await fe(n.publicKey)]},client_name:t.clientName,contacts:t.clientContact?[t.clientContact]:void 0})})).json(),u={tokenEndpoint:o.token_endpoint,clientId:p.client_id,privateJwk:await fe(n.privateKey),shlDecrypt:r.decrypt};return{state:ge.default.encode(JSON.stringify(u))}}async function pu(t){let e=ke(t.state),r=await q(e.privateJwk,"ES256"),n=await new me({}).setIssuer(e.clientId).setSubject(e.clientId).setAudience(e.tokenEndpoint).setExpirationTime("3 minutes").setProtectedHeader({alg:"ES256"}).setJti(Yn(32)).sign(r),o=await(await fetch(`${e.tokenEndpoint}`,{method:"POST",headers:{"content-type":"application/x-www-form-urlencoded","Shlink-Pin":"1234"},body:hr.stringify({scope:"__shlinks",grant_type:"client_credentials",client_assertion_type:"urn:ietf:params:oauth:client-assertion-type:jwt-bearer",client_assertion:n})})).json(),a=o.authorization_details.flatMap(f=>f.locations).map(f=>fetch(f,{headers:{authorization:`Bearer ${o.access_token}`}}).then(A=>A.text())),p=e.shlDecrypt?ge.default.toBuffer(e.shlDecrypt):null,u=a.map(async f=>{if(p){let A=await Oe(await f,p);return new TextDecoder().decode(A.plaintext)}else return f});return{shcs:(await Promise.all(u)).flatMap(f=>JSON.parse(f).verifiableCredential)}}export{cu as connect,ke as decodeBase64urlToJson,ou as decodeToJson,au as flags,su as needPin,pu as pull,Yn as randomStringWithEntropy};
/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */
/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */
//# sourceMappingURL=index.js.map
